{% extends "base.html" %}
{% block content %}

<audio id="bg-audio" autoplay muted playsinline preload="auto">
    <source src="{{ url_for('static', filename='audio/voice_call.mp3') }}" type="audio/mpeg">
    Your browser does not support the audio element.
</audio>

<button id="unmute-audio-button" style="display:none;">Tap to Unmute</button>


<script src="{{ url_for('static', filename='js/call.js') }}"></script>

<a href="{{ url_for('messenger') }}" class="close-button"><</a>

<div class="center-container">
    <br><br><br><br><br><br><br><br><br><br><br><br><br>
    <a class="profile-link profile-large">
        <img src="{{ url_for('static', filename='images/profile.jpeg') }}" alt="Profile">
    </a>
    <h3>Stefanus & Eunice's camera is off</h3>
</div>


<div class="call-controls">
    <a href="{{ url_for('video_call') }}" title="Video Off">
        <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="none" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
            <!-- Original video camera icon -->
            <path d="M17 10.5V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2v-4.5l5 5v-13l-5 5z"/>
            <!-- Diagonal strike-through -->
            <line x1="3" y1="3" x2="21" y2="21" stroke="red" stroke-width="2"/>
        </svg>
    </a>
    <a href="#" title="Mic">
        <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="black" viewBox="0 0 24 24">
            <path d="M12 14a3 3 0 0 0 3-3V5a3 3 0 0 0-6 0v6a3 3 0 0 0 3 3z"/>
            <path d="M19 10v1a7 7 0 0 1-14 0v-1"/>
            <line x1="12" y1="19" x2="12" y2="23"/>
            <line x1="8" y1="23" x2="16" y2="23"/>
        </svg>
    </a>
    <a href="#" title="Speaker">
        <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="black" viewBox="0 0 24 24">
            <path d="M11 5L6 9H2v6h4l5 4V5z"/>
            <path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"/>
        </svg>
    </a>
    <a href="{{ url_for('messenger') }}" title="End Call" class="end-call">
        <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="white" viewBox="0 0 24 24">
            <path d="M21 15.46l-5.27-1.32a1 1 0 0 0-1.23.76l-.8 3.26a16 16 0 0 1-4.4 0l-.8-3.26a1 1 0 0 0-1.23-.76L3 15.46A2 2 0 0 1 1 13.58V9.42a2 2 0 0 1 2-1.88h18a2 2 0 0 1 2 1.88v4.16a2 2 0 0 1-2 1.88z"/>
        </svg>
    </a>
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {
    const audio = document.getElementById("bg-audio");
    const unmuteButton = document.getElementById("unmute-audio-button");
    
    const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;

    if (isIOS) {
        unmuteButton.style.display = "block";

        unmuteButton.addEventListener("click", () => {
            audio.muted = false;
            audio.play().catch(err => console.log("Play failed:", err));
            unmuteButton.style.display = "none";
        });
    } else {
        // For non-iOS: try autoplay directly
        audio.muted = false;
        audio.play().catch(err => {
            console.warn("Autoplay failed:", err);
            unmuteButton.style.display = "block"; // Fallback for unexpected autoplay failures
        });
    }
});
</script>


{% endblock %}
