{% extends "base.html" %}
{% block content %}

<div class="video-wrapper">
    <video id="vidcall-video" autoplay muted playsinline preload="auto">
        <source src="{{ url_for('static', filename='videos/reels.mp4') }}" type="video/mp4">
        Your browser does not support the video tag.
    </video>

    <!-- Unmute Button -->
    <button id="unmute-button">Tap to Unmute</button>
</div>


<div class="vidcam-container">
    <video id="vidcall-stream" autoplay playsinline></video>
</div>

<button id="switch-camera-btn" class="switch-camera-button" title="Switch Camera">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2"
        stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
        <polyline points="23 4 23 10 17 10" />
        <polyline points="1 20 1 14 7 14" />
        <path d="M3.51 9a9 9 0 0114.13-3.36L23 10M1 14l5.36 5.36A9 9 0 0020.49 15" />
    </svg>
</button>

<a href="{{ url_for('messenger') }}" class="close-button"><</a>

        <div class="call-controls">
            <a href="{{ url_for('voice_call') }}" title="Video">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="black" viewBox="0 0 24 24">
                    <path
                        d="M17 10.5V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2v-4.5l5 5v-13l-5 5z" />
                </svg>
            </a>

            <a href="#" title="Mic">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="black" viewBox="0 0 24 24">
                    <path d="M12 14a3 3 0 0 0 3-3V5a3 3 0 0 0-6 0v6a3 3 0 0 0 3 3z" />
                    <path d="M19 10v1a7 7 0 0 1-14 0v-1" />
                    <line x1="12" y1="19" x2="12" y2="23" />
                    <line x1="8" y1="23" x2="16" y2="23" />
                </svg>
            </a>
            <a href="#" title="Speaker">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="black" viewBox="0 0 24 24">
                    <path d="M11 5L6 9H2v6h4l5 4V5z" />
                    <path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07" />
                </svg>
            </a>
            <a href="{{ url_for('messenger') }}" title="End Call" class="end-call">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="white" viewBox="0 0 24 24">
                    <path
                        d="M21 15.46l-5.27-1.32a1 1 0 0 0-1.23.76l-.8 3.26a16 16 0 0 1-4.4 0l-.8-3.26a1 1 0 0 0-1.23-.76L3 15.46A2 2 0 0 1 1 13.58V9.42a2 2 0 0 1 2-1.88h18a2 2 0 0 1 2 1.88v4.16a2 2 0 0 1-2 1.88z" />
                </svg>
            </a>
        </div>

        <script src="{{ url_for('static', filename='js/call.js') }}"></script>
        <script src="{{ url_for('static', filename='js/capture.js') }}"></script>
        <script>
            document.addEventListener("DOMContentLoaded", function () {
                const video = document.getElementById("vidcall-video");
                const unmuteButton = document.getElementById("unmute-button");

                // Attempt to autoplay silently
                video.play().catch(err => {
                    console.log("Autoplay failed:", err);
                });

                // User taps to unmute
                unmuteButton.addEventListener("click", () => {
                    video.muted = false;
                    video.play().catch(err => console.log("Play after unmute failed:", err));
                    unmuteButton.style.display = "none";
                });

                // Auto-hide the button after 5 seconds if not clicked
                setTimeout(() => {
                    if (video.muted) {
                        unmuteButton.style.display = "none";
                    }
                }, 5000);
            });
        </script>

        {% endblock %}